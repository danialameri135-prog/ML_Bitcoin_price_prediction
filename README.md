# ML_Bitcoin_price_prediction

✅جلوگیری از Leakage

✅تحلیل اولیه Train

✅ه feature engineering

✅ کشف همبستگی ها با ستون تارگت

✅انتخاب Scale درست

✅ مقایسه مدل ها با نمودار ها و کشف بهترین مدل

✅استفاده از روش Rolling_Window

✅مدیریت Outlier

✅ تفسیر مدل با shap

✅تحلیل اولیه

✅تحلیل عمیقتر

✅ انتقال تجربه
## پروژه تایم سریس پیشبینی قیمت بیتکوین
کتابخانه های لازم را ایمپورت کردم

## تحلیل اولیه روی دیتاست انجام دادم عملیات
قبل از split (تقسیم داده) انجام دادم

دیتاست را مرتب کردم که بتونم باهاش کار کنم و نمودار رسم کنم

ماتریس همبستگی pearson خطی و spearman غیر خطی را کشیدم فهمیدم که همبستگی بالاست من اینجا معمولا میگم که مدل خیلی خوب عمل میکنه ولی اینبار با داده های بازار مالی روبه رو هستیم که غیر قطعیه بخاطر همین فقط میتونم بگم نشونه مثبتیه 

## ساخت فیچر های جدید
فیچر log_return را ساختم
و داده را تقسیم اولیه با روش Fixed Time انجام دادم

نمودار تارگتمون که Close هست را کشیدم فهمیدم که پراکندگی اول با پراکندگی آخر برابر نیست بخاطر همین Scale کردم داده را 

فیچر هفتگی ساختم و نمودار را کشیدم و فهمیدم هیچ الگویی توی اون نیست

## تحلیل
از afuller برای فهمیدن دریفت استفاده کردم فهمیدم که داده مون دریفت داره یعنی چی؟ یعنی داده گذشته زیاد تاثیری نداره روی داده آینده پس با فهمیدن این میفهمم که split مناسب کارمون Rolling_Window هست 

نمودار acf را کشیدم که بفهمم چه lag هایی برای داده ما مناسب اند

توضیع را چک کردم غیر نرماله 

و دریفت را با روش دیگه بررسی کردم فهمیدم که بله ولقعا دریفت شدید داریم

فیچر های جدید ساختم lag 1 تا 7 
و دوباره فیچر اینجینیرینگ حدود 6 تا فیچر جدید دیگه ساختم
## Rolling
خب روش rolling_window را پیاده کردم
داخل اون
مدیریت اوتلایر انجام دادم با روش clip
فیچر های جدیدتر ساختم
مدل را فیت کردم و با متریک های متفاوت سنجیدم

4 تا مدل را پیاده کردم  و میخواستم LGBM را هم پیاده کنم ولی WARNING میداد و نمیتونست تقسیم درست برای این داده انجام بده

فهمیدم که مدل LeanierRegression بهترین عملکرد را داشت از بین تمام متریک ها و بعدش RandomForest
## نکته مهم
چیزی که برام عجیب بود اینه که درصد خطای مدل خطی زیر 10 درصده ولی مدل های درختی بالای 50 درصد خطا داشتند بخاطر همین شک کردم که شاید لیکیج داشته باشه 

اومدم یک تست کوچیک انجام دادم میخواستم ببینم که با یک فیچر که Lag1 هست بازم خطای زیر 10 درصد میده؟ فهمیدم که بله بازم همینطوریه یعنی چی؟ 
یعنی مدل لیکیج نداشته و داده قابل پیشبینی بوده

## تفسیر نمودار

حالا تحلیل مدل 
نمودار اول summary

ستون Lag_1
که بیشترین تاثیر را روی مدل داشته
میگه که هرچقدر که Lag1 افزایش پیدا میکنه پیشبینی هم افزایش پیدا میکنه و مدل اینطوری درک کرده 
ستون Open
میگه هرچقدر Open زیاد بشه درصد پیشبینی هم کم میشه

ستون log_return
میگه هرچقدر که افزایش پیدا کنه پیشبینی هم افزایش پیدا میکنه

نمودار waterfal
من 3 تا نمونه بررسی کردم نمونه های 0و 500و 700 و دیدم بله کاملا باحرفی که قبلا زدم هم راستا است 

این نمودار یک نقطه پیشفرض در نظر میگیره و مثلا میگه که بخاطر lag1 بیا 24 دلار بهش اضافه کن بخاط ستون Open بیا 22 دلار ازش کم کن و... در آخر تمام اینا را جمع میزنه و میفهمیم که چرا این پیشبینی را کرد

نمودار PDD را هم رسم کردم که مطمئن بشم 
وبله فهمیدم که ستون Open با تارگتمون رابطه عکس داره و ستون Lag1 با تارگتمون رابطه مستقیم داره همون حرفی که قبلا زدم 
## تفسیز عمیق تر
برای مدل های خطی میتونیم VIF بگیریم
من VIF گرفتم و نتیجه جالب بود
همه ستون ها بجز 8 ستون آخر بقیه VIF بالایی داشتند خب این یعنی به چه معنی است؟
یعنی ما نمیدونیم کدوم ویژگی واقعا برمدلمون چه تاثیری داره مثل اینکه سه نفر دارند یک جعبه را هل میدهند ما نمیتونیم بگیم که کدومشون زورش بیشتره و اینجا هم همینطور 
یعنی ما نمیتونیم بگیم چون Open  یا lag_1 بالایه پس قیمت بیتکوین هم بالایه هم خیر مدل یک منطق ناپایدار به ما داده و برای تصمیم سازی مناسب نیست ولی برای پیشبینی خیلییی عالیه 
پس یعنی تمام  تفسیر های summary و waterfall به دلیل VIF بالا نامعتبر میشوند 


و نمودار آخر مانند ICE میگه که مدل این فیچر را خوب یاد گرفته و همچنین میگه که Open رابطه عکس داره خیر ما نمیدونیم و بستگی به شرایط و بقیه فیچر ها داره


## نتیجه
پس نتیجه چی شد؟
مدل را میتونیم برای پیشبینی استفاده کنیم یعنی میدونیم که پیشبینی عالی میده ولی نمیدونیم چرا و با چه منطقی این پیشبین را داده 
این مدل کاملا قابل استفاده است برای پیشبینی های درآمد افراد و عالی عمل میکنه و من تمام جنبه هاش را بررسی کردم و فهمیدم که برای تصمیم سازی بد عمل میکنه تصمیم سازی؟ یعنی مثلا نمیتونیم بگیم چون lag_1 بالا بوده پس قیمت بیتکوین هم بالایه 
یعنی نمیتونیم همچین نتایجی را بگیریم

## کتابخانه های استفاده شده
numpy,pandas,matplotlib,seaborn,pickle,shap,statsmodels,sklearn,xgboost,catboost

## فایل ها
فایل پروژه project_a5.ipynb
فایل دیتاست Binance_BTCUSTD_d.csv

